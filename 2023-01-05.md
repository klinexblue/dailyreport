# 20230105

## 1. 한번 껐던 서버에서 아파치 웹 서버 다시 켜기

```
/usr/local/apache2/bin/httpd -k start
firewall-cmd --add-service=http
```

## 2. NT 커널에서의 /etc/hosts 파일

C:\windows\system32\drivers\etc\hosts 파일이다. UNIX와 마찬가지로 확장자는 따로 없다.  
실행시에는 관리자 권한으로 열 것.

## 3. 아파치의 가상호스트 설정
### i. 정의
/etc/hosts 파일 내 같은 IP에 도메인 네임을 두 개 정의하고, 각각 다른 HTML 파일로 접속되게 하는 일.

```
192.168.56.101   www.test.com  www.test.net
```

호스트 콘솔에 위 설정을 하면, www.test.com과 www.test.net 어느 쪽으로 접속하여도 192.168.56.101로 접속됨을 확인할 수 있다.

### ii. 설정 순서
/usr/local/apache2/conf/httpd.conf 파일에서 다음에 해당하는 내용을 찾아 주석 처리를 제거한다.

```
# Virtual hosts
Include conf/extra/httpd-vhosts.conf
```

그 다음 해당 경로에 있는 파일을 찾아 다음처럼 고친다.
- ※아래에 등장하는 경로는 전부 폴더이다. 파일 경로를 정의하면 파일 확장자까지를 폴더 이름인 줄 알고 접근을 시도하다 다음과 같은 오류를 내뱉는다.

```
AH00112: Warning: DocumentRoot [/usr/local/apache2/htdocs/arashio.html] does not exist
AH00112: Warning: DocumentRoot [/usr/local/apache2/htdocs/goldeneagle.html] does not exist
```

그러므로 별도의 index.html 파일은 뒤에 쓰지 않도록 주의하라.

```
<VirtualHost *:80>
    DocumentRoot "/usr/local/apache2/vhtml/arashio/docbase"
    ServerName www.test.com
</VirtualHost>

<VirtualHost *:80>
    DocumentRoot "/usr/local/apache2/vhtml/goldeneagle/docbase"
    ServerName www.test.net
</VirtualHost>
```

그리고 /usr/local/apache2/conf/httpd.conf 파일에 다음 내용을 추가한다.

```
DocumentRoot "/usr/local/apache2/vhtml/arashio/docbase"
<Directory "/usr/local/apache2/vhtml/arashio/docbase">
    Require all granted
</Directory>


DocumentRoot "/usr/local/apache2/vhtml/goldeneagle/docbase"
<Directory "/usr/local/apache2/vhtml/goldeneagle/docbase">
    Require all granted
</Directory>
```

단 아파치 서버 버전 2.3 버전 이하라면 이 방법으로 한다. 예전에 가상호스트 권한을 줄 때 쓰던 구문이다.

```
DocumentRoot "/usr/local/apache2/vhtml/arashio/docbase"
<Directory "/usr/local/apache2/vhtml/arashio/docbase">
    Order Allow,Deny
    Allow from all
</Directory>


DocumentRoot "/usr/local/apache2/vhtml/goldeneagle/docbase"
<Directory "/usr/local/apache2/vhtml/goldeneagle/docbase">
    Order Allow,Deny
    Allow from all
</Directory>
```

그리고 당연히, 위에 정의한 계정에 각각 index.html 파일을 마련해 둔다.

그 다음 웹 서버가 이미 구동되어 있다면 다음 명령으로 서버를 재시작시킨다.

/usr/local/apache2/bin/httpd -k restart

만약 한쪽 도메인 네임으로 권한 오류 메시지가 난다면 apache2 디렉토리의 logs/error_log 파일을 확인한다.

httpd.conf 파일의 디렉토리 권한 부여 설정을 2.3 이하 버전의 방식으로 적어두고 2.4 버전에서 구동했다면,  
이런 오류구문이 나오고 페이지 접근이 안 될 것이다.

```
[Thu Jan 05 10:47:50.902523 2023] [authz_core:error] [pid 6089:tid 140037576406784] [client 192.168.56.1:51052] AH01630: client denied by server configuration: /usr/local/apache2/vhtml/goldeneagle/docbase/
```

그러므로 버전에 맞는 명령어 구문을 잘 파악하고 작성하라.

### iii. 레퍼런스

https://cornswrold.tistory.com/348  
https://server-talk.tistory.com/3  
https://meongj-devlog.tistory.com/94  
https://bloodguy.tistory.com/entry/Apache-24-%EB%B2%84%EC%A0%84%EC%97%90%EC%84%9C-403-%EC%97%90%EB%9F%AC%EC%8B%9C-authzcoreerror-AH01630-client-denied-by-server-configuration



